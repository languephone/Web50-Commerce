{% extends "auctions/layout.html" %}

{% block body %}
    <div class="listing">    
        <h2>
            {{ listing.title }}
            {% if watchlist %}
            <span class="badge badge-secondary">Watchlist</span>
            {% endif %}
        </h2>
        <p>{{ listing.description }}</p>
        <hr>
        <p><img src="{{ listing.image }}" height="150"></p>
        <h3>Top Bid: Â£{{ top_bid.bid_amount__max }}</h3>
        <p>Listed by: {{ listing.seller }}</p>
        <p>Listed on: {{ listing.creation_date }}</p>
        <p>Category: <a href="{% url 'category' listing.category %}">{{ listing.category }}</a></p>
        <p><a href="/">back to main page</a></p>
        <hr>
        <h4>Comments:</h4>
        {% for comment in listing.listing_comments.all %}
            <p>{{ comment.comment }} ({{ comment.user }}: {{ comment.date_added }})</p>
        {% endfor %}
        
        <hr>
       <!-- Below are the forms for bidding, commenting and adding to a watchlist -->
        <form action="{% url 'bid' listing.id %}" method="post">
            {% csrf_token %}
            {{ bid_form }}
        	<input type="submit" class="btn btn-primary">
        </form>
        <form action ="{% url 'comment' listing.id %}" method="post">
            {% csrf_token %}
            {{ comment_form }}
            <input type="submit" class="btn btn-primary">
        </form>
        <form action="{% url 'watchlist' %}" method="post">
            {% csrf_token %}
            <input type="hidden" value="{{ listing.id }}" name="listing_id">
            <button type="submit" class="btn btn-primary">
                {% if watchlist %}
                    Remove from Watchlist
                {% else %}
                    Add to Watchlist
                {% endif %} 
            </button>
        </form>
    </div>
{% endblock %}